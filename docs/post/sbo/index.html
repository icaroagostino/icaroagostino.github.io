<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Combinando Algoritmo Genético e Simulação em R! :: Ícaro Agostino — Forecasting, Simulação e Otimização</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Photo by Vitaly Vlasov from Pexels
Neste post apresento a implementação de uma abordagem do tipo Otimização baseada em Simulação combinando Algoritmo Genético e Simulação de Eventos Discretos, e demonstro uma aplicação para balanceamento de linhas de produção. Antes de tudo vamos entender o que é essa abordagem e como pode ser utilizada.
Todo o código desse post está disponível em github.com/icaroagostino/SBO
Vamos começar&amp;hellip;
Otimização baseada em Simulação (SBO) Otimização baseada em simulação (do inglês simulation-based optimization - SBO) é uma estratégia que combina os pontos fortes dos algoritmos de otimização com métodos de simulação."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/sbo/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">









<meta property="og:title" content="Combinando Algoritmo Genético e Simulação em R!" />
<meta property="og:description" content="Otimização baseada em Simulação em R. Nesse post apresento uma abordagem híbrida que combina algoritmo genético e simulação de eventos discretos para otimização de um problema industrial." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/sbo/" />
<meta property="article:published_time" content="2020-10-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-10-27T00:00:00+00:00" /><meta property="og:site_name" content="Ícaro Agostino" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="http://icaroagostino.github.io/blog" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">Ícaro Agostino</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/post">Posts  </a></li>
        
      
        
          <li><a href="/sobre">Sobre</a></li>
        
      
        
          <li><a href="/curriculum"> Curriculum</a></li>
        
      
        
          <li><a href="/archive">  Archive</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/post">Posts  </a></li>
      
    
      
        <li><a href="/sobre">Sobre</a></li>
      
    
      
        <li><a href="/curriculum"> Curriculum</a></li>
      
    
      
        <li><a href="/archive">  Archive</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="/post/sbo/">Combinando Algoritmo Genético e Simulação em R!</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2020-10-27
        </span>

        
          
        
      

      <span class="post-author">— Written by Ícaro</span>
      
        <span class="post-read-time">— 10 min read</span>
      
    </div>

    

    
      
        <img src="/img/sbo.jpg" class="post-cover" />
      
    

    <div class="post-content">
      <p><a href="https://www.pexels.com/pt-br/foto/apontando-close-codificacao-comodo-1342460/">Photo by Vitaly Vlasov from Pexels</a></p>
<p>Neste post apresento a implementação de uma abordagem do tipo <strong>Otimização
baseada em Simulação</strong> combinando <strong>Algoritmo Genético</strong> e <strong>Simulação de Eventos Discretos</strong>, e demonstro uma aplicação para balanceamento de
linhas de produção. Antes de tudo vamos entender o que é essa abordagem e como pode ser utilizada.</p>
<p>Todo o código desse post está disponível em <a href="https://github.com/icaroagostino/SBO"><strong>github.com/icaroagostino/SBO</strong></a></p>
<p><em>Vamos começar&hellip;</em></p>
<p><img src="https://media1.tenor.com/images/0e8e43de3db05b87ae105476796854ff/tenor.gif#center" alt=""></p>
<h1 id="otimização-baseada-em-simulação-sbo"><strong>Otimização baseada em Simulação (SBO)</strong></h1>
<p><strong>Otimização baseada em simulação</strong> (do inglês <em>simulation-based optimization - SBO</em>) é uma estratégia que combina os pontos fortes dos algoritmos de otimização com métodos de simulação. Usualmente abordagens de otimização são adotadas para resolver problemas complexos que podem ser descritos matematicamente, mas falham, em muitos casos, em testar suas soluções em um ambiente realista que consiga considerar características probabilísticas que são observadas na realidade.</p>
<p>Aí que entra a <strong>simulação</strong> para resolver esse problema, modelos de simulação são capazes de representar a realidade de forma muito mais &ldquo;fiel&rdquo;, porém não são muito úteis para resolver problemas em que precisamos definir parâmetros ótimos.</p>
<p>Dessa forma, <strong>combinar</strong> os dois métodos é uma das solução mais sofisticadas que temos atualmente para resolver problemas de otimização, tendo como base a simulação para avaliar de forma interativa e estocástica nossas possíveis soluções.</p>



<p align="center">
<img src="https://raw.githubusercontent.com/icaroagostino/SBO/master/img/SBO-.PNG" width="600">
</p>


<p>Aqui a <strong>função objetivo</strong> comumente vista nas abordagens tradicionais é <strong>substituída pelo modelo de simulação</strong>, dessa forma iterativamente a abordagem SBO integra os dois métodos em cada ciclo de otimização.</p>
<p>Para esse post vamos adotar o <strong>Algoritmo Genético</strong> como método de otimização e a <strong>Simulação de Eventos Discretos</strong> como abordagem de simulação. Serão utilizados os pacotes <code>Simmer</code> e <code>GA</code>, ambos serão integrados de forma que cada conjunto de soluções gerados pela Otimização seja testado em um ambiente simulado que representa um
possível estado do sistema.</p>
<h3 id="algoritmos-genéticos-ga">Algoritmos Genéticos (GA)</h3>
<p>Nessa aplicação o coração da abordagem é o algoritmo genético (GA), se trata de uma heurística de otimização estocástica inspirada nos princípios básicos da evolução biológica e da seleção natural. De forma simplificada, precisamos visualizar uma solução possível para um problema como um indivíduo, que na inicialização do GA pode ser gerado aleatoriamente ou utilizando algum <em>benchmark</em>, um conjunto de indivíduos é uma população.</p>



<p align="center">
<img src="ga.png" width="600">
</p>


<p>A adequação de cada indivíduo é avaliada por uma <strong>função objetivo</strong> e apenas os indivíduos mais aptos se reproduzem, passando a sua informação genética aos seus descendentes por meio dos operadores  de  <strong>mutação</strong>  e  de  <strong>cruzamento</strong>. Importante lembrar que na nossa abordagem, a avaliação é feita por meio da <strong>simulação</strong> em substituição de uma equação matemática estática.</p>
<p>Assim, com o operador de <strong>seleção</strong>, o GA imita o comportamento dos organismos naturais num ambiente competitivo, no qual apenas os mais qualificados e a sua descendência sobrevivem. O cruzamento forma novos resultados de duas soluções “progenitoras” através da combinação de parte da informação genética de cada um.</p>
<p>A <strong>mutação</strong> é um operador genético que altera, de forma geral e aleatória, os valores dos genes de uma solução, permitindo escapar de ótimos locais. O processo de evolução termina com base em  alguns critérios de <strong>convergência</strong>. Alternativamente, o GA é interrompido quando um número suficientemente grande de gerações passou sem qualquer melhoria no valor da função objetivo, ou quando uma estatística populacional atinge um limite pré-definido.</p>
<p>Tudo isso fica mais claro em um <strong>exemplo</strong>, então nas seções seguintes vamos criar um ambiente de <strong>simulação</strong>, definir as <strong>variáveis de decisão</strong>, conectar tudo e rodar.</p>
<h3 id="criando-um-ambiente-de-simulação-com-simmer">Criando um ambiente de Simulação com <code>Simmer</code></h3>
<p>O pacote <code>Simmer</code> implementado em <code>R</code> fornece um framework para
simulação de eventos discretos com alta performance, implementado em
<code>C++</code>. O pacote funciona como uma API executando scripts de <code>R</code>, além
disso o pacote possui funções implementadas para computação paralela
permitindo múltiplas rodadas de simulação em diferentes núcleos.</p>
<p>Como caso teste para demonstrar a abordagem vamos implementar o caso
relatado por <a href="https://doi.org/10.1016/j.asoc.2014.02.005">Marichelvam, Prabaharan e Yang
(2014)</a>, se trata de uma linha de produção de peças metálicas. O processo de produção
possui 5 etapas: punching, bending, welding, power pressing e drilling.
Cada etapa possui um número diferente de máquinas paralelas e idênticas.</p>



<p align="center">
<img src="https://raw.githubusercontent.com/icaroagostino/SBO/master/img/flows.png" width="600">
</p>


<blockquote>
<p>O problema a ser resolvido nesse caso é o de balancemento da produção, ou seja definir de forma otimizada quantas máquinas em cada processo devem ser alocadas.</p>
</blockquote>
<p>No <code>R</code> é preciso instalar as bibliotecas necessárias utilizando a função
<code>install.packages(c(&quot;simmer&quot;, &quot;simmer.plot&quot;, &quot;GA&quot;))</code>. Após isso vamos
carregar as bibliotecas e criar o ambiente de simulação.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#75715e"># carregando os pacotes</span>
    <span style="color:#a6e22e">library</span>(simmer)
    <span style="color:#a6e22e">library</span>(simmer.plot)

    <span style="color:#75715e"># Criando ambiente de simulacao</span>
      env <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">simmer</span>(<span style="color:#e6db74">&#34;model&#34;</span>)
      <span style="color:#75715e"># Definindo a trajetoria</span>
      flowShop <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">trajectory</span>(<span style="color:#e6db74">&#34;flowShop&#34;</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#75715e">## add a Punching activity </span>
        <span style="color:#a6e22e">seize</span>(<span style="color:#e6db74">&#34;Punching&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">timeout</span>(<span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">release</span>(<span style="color:#e6db74">&#34;Punching&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#75715e">## add a Bending activity</span>
        <span style="color:#a6e22e">seize</span>(<span style="color:#e6db74">&#34;Bending&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">timeout</span>(<span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">20</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">release</span>(<span style="color:#e6db74">&#34;Bending&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#75715e">## add a Welding activity</span>
        <span style="color:#a6e22e">seize</span>(<span style="color:#e6db74">&#34;Welding&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">timeout</span>(<span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">15</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">release</span>(<span style="color:#e6db74">&#34;Welding&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
      <span style="color:#75715e">## add a Pressing activity</span>
        <span style="color:#a6e22e">seize</span>(<span style="color:#e6db74">&#34;Pressing&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">timeout</span>(<span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">12</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">release</span>(<span style="color:#e6db74">&#34;Pressing&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
      <span style="color:#75715e">## add a Drilling activity</span>
        <span style="color:#a6e22e">seize</span>(<span style="color:#e6db74">&#34;Drilling&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">timeout</span>(<span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">6</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">release</span>(<span style="color:#e6db74">&#34;Drilling&#34;</span>, <span style="color:#ae81ff">1</span>)
</code></pre></div><p>Os tempos atribuídos aos processos são arbitrários, para adicionar
estocasticidade vamos utilizar a distribuição normal. Nesse ambiente de
produção o processo segue um fluxo linear, dessa forma a trajetória
construída foi adicionada ao ambiente de simulação. Agora vamos
adicionar os recursos que serão o número de máquinas paralelas em cada
etapa.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#75715e"># Adicionando recursos</span>
    env <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Punching&#34;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Bending&#34;</span>,  <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Welding&#34;</span>,  <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Pressing&#34;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Drilling&#34;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_generator</span>(<span style="color:#e6db74">&#34;flowShop&#34;</span>, flowShop, <span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>))
</code></pre></div><p>Como solução inicial duas máquinas paralelas foram adicionadas em cada
etapa. Além disso, foi adicionado uma demanda estocástica com intervalo
de 5 minutos seguindo uma distribuição normal para cada ordem de
produção. Agora vamos simular 30 vezes esse cenário durante um dia (2
turnos totalizando 960 minutos) e calcular a utilização média dos
recursos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    envs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span>, <span style="color:#a6e22e">function</span>(i) {
        <span style="color:#a6e22e">run</span>(env,<span style="color:#ae81ff">960</span>) <span style="color:#75715e"># Simula um dia (2 turnos)</span>
      })
</code></pre></div><p>Agora vamos calcular a utilização média dos recursos, para isso vamos
utilizar o pacote <code>Simmer.plot</code> que é uma extensão do <code>Simmer</code> para
plotagem de estatísticas e trajetórias.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">get_mon_resources</span>(envs))
</code></pre></div>


<p align="center">
<img src="https://raw.githubusercontent.com/icaroagostino/SBO/master/img/utilization1.png">
</p>


<p>Como podemos ver, nossa solução inicial arbitrária com 2 máquinas
paralelas em cada etapa não é adequada para a demanda atual, formando
fila excessiva na etapa Bending e subutilizando as demais etapas. A
utilização média dos recursos para esse cenário foi de <strong>72.71%</strong>.</p>
<h3 id="utilizando-algoritmo-genético-com-o-pacote-ga">Utilizando algoritmo genético com o pacote <code>GA</code></h3>
<p>O pacote <code>GA</code> implementado em <code>R</code> fornece uma coleção de funções de
propósito geral para otimização usando algoritmos genéticos. A
otimização utilizando algoritmo genético pode ser executada
sequencialmente ou em paralelo para maior performance.</p>
<p>Para solucionar esse problema de balanceamento vamos utilizar Otimização
baseada em Simulação, integrando algoritmo genético ao ambiente de
simulação implementado. Vamos carregar o pacote <code>GA</code> e integrar a
simulação.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#75715e"># carregando pacote</span>
    <span style="color:#a6e22e">library</span>(GA)
</code></pre></div><p>O pacote utiliza a função <code>ga</code> para buscar uma solução otimizada, para
isso precisamos passar para o algoritmo uma função objetivo, podendo ser
qualquer função definida em <code>R</code>, assim como as restrições e parâmetros
da otimização. Agora vamos encapsular a simulação criada em uma função
que recebe como argumento o número de máquinas paralelas em cada etapa e
no fim retorna a utilização média dos recursos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#75715e"># Criando uma funcao para simular o cenario</span>
    simular <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(Punching, Bending, Welding, Pressing, Drilling){
      <span style="color:#75715e"># Criando ambiente de simulacao</span>
      env <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">simmer</span>(<span style="color:#e6db74">&#34;model&#34;</span>) ;  flowShop <span style="color:#f92672">&lt;-</span> flowShop
      <span style="color:#75715e"># Adcionando recursos</span>
      env <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Punching&#34;</span>, <span style="color:#a6e22e">round</span>(Punching, <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Bending&#34;</span>,  <span style="color:#a6e22e">round</span>(Bending , <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Welding&#34;</span>,  <span style="color:#a6e22e">round</span>(Welding , <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Pressing&#34;</span>, <span style="color:#a6e22e">round</span>(Pressing, <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Drilling&#34;</span>, <span style="color:#a6e22e">round</span>(Drilling, <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_generator</span>(<span style="color:#e6db74">&#34;flowShop&#34;</span>, flowShop, <span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>))
      <span style="color:#75715e"># Run com replicacoes</span>
      envs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">function</span>(i) {<span style="color:#a6e22e">reset</span>(env) ; <span style="color:#a6e22e">run</span>(env,<span style="color:#ae81ff">960</span>)})
      <span style="color:#75715e"># Calculando a utilizacao media dos recursos</span>
      util <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">get_mon_resources</span>(envs) <span style="color:#f92672">%&gt;%</span>
        dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">group_by</span>(.data<span style="color:#f92672">$</span>resource, .data<span style="color:#f92672">$</span>replication) <span style="color:#f92672">%&gt;%</span>
        dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(dt <span style="color:#f92672">=</span> .data<span style="color:#f92672">$</span>time <span style="color:#f92672">-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">lag</span>(.data<span style="color:#f92672">$</span>time)) <span style="color:#f92672">%&gt;%</span>
        dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">mutate</span>(in_use <span style="color:#f92672">=</span> .data<span style="color:#f92672">$</span>dt <span style="color:#f92672">*</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">lag</span>(.data<span style="color:#f92672">$</span>server <span style="color:#f92672">/</span> .data<span style="color:#f92672">$</span>capacity)) <span style="color:#f92672">%&gt;%</span>
        dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">summarise</span>(utilization <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(.data<span style="color:#f92672">$</span>in_use, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(.data<span style="color:#f92672">$</span>dt, na.rm<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span>
        dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">summarise</span>(utilization <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(.data<span style="color:#f92672">$</span>utilization))
      <span style="color:#75715e"># Retorna a utilização média dos recursos</span>
      <span style="color:#a6e22e">return</span>(util[[2]] <span style="color:#f92672">%&gt;%</span> mean)
    }
</code></pre></div><p>Se você estiver utilizando a versão <code>dplyr</code> 1.0 ou maior, execute o código a aseguir para desativar os avisos da função <code>summarise()</code> ao longo da otimização:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">options</span>(dplyr.summarise.inform <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p>Após o encapsulamento do cenário de simulação como uma função, basta
parametrizar o algoritmo genético e executar a otimização. Aqui vamos
assumir os seguintes parâmetros arbitrários:</p>
<ul>
<li>Tamanho da população: 10</li>
<li>Quantidade máxima de iterações: 20</li>
<li>Taxa de crossover: 80%</li>
<li>Taxa de mutação: 10%</li>
</ul>
<p>Como restrições vamos considerar o número mínimo de máquinas paralelas
em cada etapa como 1 e o máximo como 5.</p>
<p>A integração entre a Otimização e Simulação acontecerá da seguinte
forma: cada conjunto de soluções será testado em um ambiente de
simulação que representa um estado possível do cenário real, retornando
a utilização média dos recursos como KPI a ser maximizado. Em cada
geração teremos 10 soluções possíveis, os melhores indivíduos de cada
iteração sofrerão crossover e mutação gerando uma nova geração de
soluções. Ao fim de 20 iterações a melhor solução será retornada
maximizando a utilização dos recursos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    GA <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ga</span>(type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;real-valued&#34;</span>,
             fitness <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">simular</span>(x[1],x[2],x[3],x[4],x[5]),
             lower <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>),
             upper <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>),
             popSize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,
             maxiter <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>,
             pcrossover <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>,
             pmutation <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>)
    <span style="color:#75715e"># Melhor solucao</span>
    solution <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">round</span>(GA<span style="color:#f92672">@</span>solution) <span style="color:#f92672">%&gt;%</span> print

    <span style="color:#75715e">##      x1 x2 x3 x4 x5</span>
    <span style="color:#75715e">## [1,]  2  4  3  2  1</span>

    <span style="color:#a6e22e">plot</span>(GA)
</code></pre></div>


<p align="center">
<img src="https://raw.githubusercontent.com/icaroagostino/SBO/master/img/GA.png">
</p>


<p>A solução que maximiza a utilização dos recursos é: [2, 4, 3, 2, 1]
representando o número de máquinas paralelas em cada etapa
respectivamente. Agora vamos analisar a qualidade dessa solução no
cenário simulado.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    env <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">simmer</span>(<span style="color:#e6db74">&#34;model&#34;</span>)

    env <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Punching&#34;</span>, solution[1]) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Bending&#34;</span>,  solution[2]) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Welding&#34;</span>,  solution[3]) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Pressing&#34;</span>, solution[4]) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_resource</span>(<span style="color:#e6db74">&#34;Drilling&#34;</span>, solution[5]) <span style="color:#f92672">%&gt;%</span>
        <span style="color:#a6e22e">add_generator</span>(<span style="color:#e6db74">&#34;flowShop&#34;</span>, flowShop, <span style="color:#a6e22e">function</span>() <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>))

    envs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">reset</span>(env) ; <span style="color:#a6e22e">run</span>(env,<span style="color:#ae81ff">960</span>) <span style="color:#75715e"># Simula um dia (2 turnos)</span>

    <span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">get_mon_resources</span>(envs))
</code></pre></div>


<p align="center">
<img src="https://raw.githubusercontent.com/icaroagostino/SBO/master/img/utilization2.png">
</p>


<p>Como podemos ver a solução encontrada pela Otimização baseada em
Simulação foi capaz de maximizar a utilização média dos recursos, se
apresentando como uma solução robusta capaz de lidar com a
estocasticidade do sistema. A utilização média dos recursos nesse novo
cenário foi de <strong>98.73%</strong>.</p>
<p>O exemplo ilustrado demonstra a facilidade de integração da simulação e
otimização utilizando <code>R</code>, podendo se estender a cenários mais
complexos, desde que tenhamos variáveis de decisão e um KPI da simulação
a ser maximizado ou minimizado.</p>
<h2 id="aplicação-em-um-artigo">Aplicação em um artigo</h2>
<p>As implementações desse exemplo geraram uma publicação no congresso <strong>ENEGEP 2020</strong> que ocorreu online em outubro desse ano. Aproveito para deixar os links para a versão final do artigo, os slides e o vídeo da minha participação =).</p>
<ul>
<li><strong>Artigo</strong>: <a href="http://www.abepro.org.br/biblioteca/TN_STO_344_1765_40002.pdf">SBO para balanceamento de Flow Shop híbrido: Implementação e aplicação em R</a></li>
<li><strong>Slides da apresentação</strong>: <a href="https://docs.google.com/presentation/d/e/2PACX-1vQj5gJ-TVwyKali481iEe6giBJJx7LBUtXlvx1p7GZ2tNa3RIAznz5sTZXPUIfUiH1tgsLaB_RDMumC/pub?start=false&amp;loop=false&amp;delayms=3000">google slides</a></li>
<li><strong>Vídeo da apresentação no evento</strong>:</li>
</ul>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/kZyk-G7TWyA" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>Bom, como falei no inicio do post toda essa aplicação está com código aberto nesse repositório do Github <a href="https://github.com/icaroagostino/SBO"><strong>icaroagostino/SBO</strong></a>. O código é bem simples pois aproveita as implementações dos pacotes <code>GA</code> e <code>Simmer</code>, e também é bem genérico possibilitando extender para outras aplicações.</p>
<h3 id="referências">Referências</h3>
<p>Se quiser se aprofundar eu sugiro como recurso inicial os artigos originais dos dois pacotes, vocês vão encontrar explicações teóricas, detalhes de implementação e muito mais.</p>
<ul>
<li>Simmer: <a href="https://doi.org/10.18637/jss.v090.i02">https://doi.org/10.18637/jss.v090.i02</a></li>
<li>GA: <a href="http://www.jstatsoft.org/v53/i04/">http://www.jstatsoft.org/v53/i04/</a></li>
</ul>
<p>Para citar os pacotes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">    <span style="color:#a6e22e">citation</span>(<span style="color:#e6db74">&#34;simmer&#34;</span>)

    <span style="color:#75715e">## </span>
    <span style="color:#75715e">## To cite &#39;simmer&#39; in publications use:</span>
    <span style="color:#75715e">## </span>
    <span style="color:#75715e">## Ucar I, Smeets B, Azcorra A (2019). &#34;simmer: Discrete-Event Simulation</span>
    <span style="color:#75715e">## for R.&#34; _Journal of Statistical Software_, *90*(2), 1-30. doi:</span>
    <span style="color:#75715e">## 10.18637/jss.v090.i02 (URL: https://doi.org/10.18637/jss.v090.i02).</span>
    <span style="color:#75715e">## </span>
    <span style="color:#75715e">## If appropriate, use also:</span>
    <span style="color:#75715e">## </span>
    <span style="color:#75715e">## Ucar I, Hernández JA, Serrano P, Azcorra A (2018). &#34;Design and Analysis</span>
    <span style="color:#75715e">## of 5G Scenarios with simmer: An R Package for Fast DES Prototyping.&#34;</span>
    <span style="color:#75715e">## _IEEE Communications Magazine_, *56*(11), 145-151. doi:</span>
    <span style="color:#75715e">## 10.1109/MCOM.2018.1700960 (URL:</span>
    <span style="color:#75715e">## https://doi.org/10.1109/MCOM.2018.1700960).</span>
    <span style="color:#75715e">## </span>

    <span style="color:#a6e22e">citation</span>(<span style="color:#e6db74">&#34;GA&#34;</span>)

    <span style="color:#75715e">## </span>
    <span style="color:#75715e">## To cite &#39;GA&#39; R package in publications, please use:</span>
    <span style="color:#75715e">## </span>
    <span style="color:#75715e">##   Luca Scrucca (2013). GA: A Package for Genetic Algorithms in R.</span>
    <span style="color:#75715e">##   Journal of Statistical Software, 53(4), 1-37. URL</span>
    <span style="color:#75715e">##   http://www.jstatsoft.org/v53/i04/</span>
    <span style="color:#75715e">## </span>
    <span style="color:#75715e">##   Luca Scrucca (2017). On some extensions to GA package: hybrid</span>
    <span style="color:#75715e">##   optimisation, parallelisation and islands evolution. The R Journal,</span>
    <span style="color:#75715e">##   9/1, 187-206. https://journal.r-project.org/archive/2017/RJ-2017-008</span>
    <span style="color:#75715e">## </span>
</code></pre></div><p>Se quiser trocar uma ideia sobre esse assunto ou qualquer outro relacionado a <code>R</code>, o twitter é a plataforma que mais uso para me comunicar com a galera da comunidade. Aproveito e deixo minhas outras redes também.</p>
<div style="text-align: center;">
	<a style="margin-right: 5px" href="https://twitter.com/icaro_agostino" target="_blank" rel="noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>

	<a style="margin-right: 5px; margin-left: 5px" href="https://github.com/icaroagostino" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>

	<a style="margin-right: 5px; margin-left: 5px" href="http://www.linkedin.com/in/icaroagostino" target="_blank" rel="noopener" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
	
</div>
<p>Até o próximo post :D</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
            
              <span class="button next">
                <a href="/post/learnr/">
                  <span class="button__text">Materiais gratuitos para aprender R em 2020</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        


<style>
#share-buttons {text-align:center;}
#share-buttons > div {
  display:inline-block;
  margin:1px 10px;
  padding:3px;
}

#share-buttons > div > svg {height: 16px; fill: #5e5d5d; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
</style>

<span style="color: #5e5d5d;">Compartilhe em: </span><div id="share-buttons">

<div class="twitter" title="Compartilhe no Twitter" onclick="window.open('http://twitter.com/share?url=https://icaroagostino.github.io\/post\/sbo\/&text=Combinando Algoritmo Genético e Simulação em R!');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>

<div class="linkedin" title="Compartilhe no Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://icaroagostino.github.io\/post\/sbo\/&title=Combinando Algoritmo Genético e Simulação em R!');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>

<div class="facebook" title="Compartilhe no Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://icaroagostino.github.io\/post\/sbo\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
</div>

        <footer class="footer">
  <div class="footer__inner">
    
      <a href="http://icaroagostino.github.io/blog" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">Ícaro Agostino</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme: <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
        </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
